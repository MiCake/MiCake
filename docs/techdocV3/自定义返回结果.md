# 自定义返回结果

MiCake 允许您完全自定义 API 的响应格式，以满足特定的业务需求。

## 自定义响应包装器

### 实现 IResponseWrapper

```csharp
public class CustomResponse<T> : IResponseWrapper
{
    public bool Success { get; set; }
    public int StatusCode { get; set; }
    public string Message { get; set; }
    public T Data { get; set; }
    public DateTime ServerTime { get; set; }
    
    public CustomResponse(T data, string message, int statusCode = 200)
    {
        Success = statusCode >= 200 && statusCode < 300;
        StatusCode = statusCode;
        Message = message;
        Data = data;
        ServerTime = DateTime.UtcNow;
    }
}
```

### 注册自定义包装器

```csharp
public class MyAppModule : MiCakeModule
{
    public override void ConfigureServices(ModuleConfigServiceContext context)
    {
        context.Services.Configure<MiCakeAspNetOptions>(options =>
        {
            options.UseDataWrapper = true;
            options.WrapperFactory = (data, statusCode, message) =>
            {
                return new CustomResponse<object>(data, message, statusCode);
            };
        });
        
        base.ConfigureServices(context);
    }
}
```

## 分页响应

### 自定义分页包装器

```csharp
public class PagedResponse<T> : IResponseWrapper
{
    public string Code { get; set; }
    public string Message { get; set; }
    public PagedData<T> Data { get; set; }
}

public class PagedData<T>
{
    public List<T> Items { get; set; }
    public int PageIndex { get; set; }
    public int PageSize { get; set; }
    public int TotalCount { get; set; }
    public int TotalPages => (int)Math.Ceiling(TotalCount / (double)PageSize);
}

// 使用
[HttpGet]
public async Task<PagedResponse<Product>> GetProducts(int pageIndex = 1, int pageSize = 10)
{
    var query = _productRepository.Query();
    var total = await query.CountAsync();
    var items = await query
        .Skip((pageIndex - 1) * pageSize)
        .Take(pageSize)
        .ToListAsync();
    
    return new PagedResponse<Product>
    {
        Code = "200",
        Message = "Success",
        Data = new PagedData<Product>
        {
            Items = items,
            PageIndex = pageIndex,
            PageSize = pageSize,
            TotalCount = total
        }
    };
}
```

## 多语言支持

```csharp
public class LocalizedResponse<T> : IResponseWrapper
{
    public string Code { get; set; }
    public string Message { get; set; }
    public T Data { get; set; }
    public string Language { get; set; }
    
    public LocalizedResponse(T data, string messageKey, string language)
    {
        Code = "200";
        Data = data;
        Language = language;
        Message = GetLocalizedMessage(messageKey, language);
    }
    
    private string GetLocalizedMessage(string key, string language)
    {
        // 从资源文件或数据库获取本地化消息
        return key;
    }
}
```

## 小结

自定义返回结果允许您：

- 实现 `IResponseWrapper` 接口
- 自定义响应结构
- 支持分页、多语言等场景
- 完全控制响应格式
